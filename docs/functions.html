<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Functions | Quality of Location - developing a new pitch metric</title>
  <meta name="description" content="Chapter 4 Functions | Quality of Location - developing a new pitch metric" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Functions | Quality of Location - developing a new pitch metric" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Functions | Quality of Location - developing a new pitch metric" />
  
  
  

<meta name="author" content="Doug Rose" />


<meta name="date" content="2023-12-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="example-model.html"/>
<link rel="next" href="applying-functions.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Pitch Location Quality Project</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#project-overview"><i class="fa fa-check"></i><b>1.1</b> Project Overview</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="extracting-cleaning-validating-transforming.html"><a href="extracting-cleaning-validating-transforming.html"><i class="fa fa-check"></i><b>2</b> Extracting, Cleaning, Validating, Transforming</a>
<ul>
<li class="chapter" data-level="2.1" data-path="extracting-cleaning-validating-transforming.html"><a href="extracting-cleaning-validating-transforming.html#extracting-dataset"><i class="fa fa-check"></i><b>2.1</b> Extracting Dataset</a></li>
<li class="chapter" data-level="2.2" data-path="extracting-cleaning-validating-transforming.html"><a href="extracting-cleaning-validating-transforming.html#explain-variables-of-interest"><i class="fa fa-check"></i><b>2.2</b> Explain Variables of Interest</a></li>
<li class="chapter" data-level="2.3" data-path="extracting-cleaning-validating-transforming.html"><a href="extracting-cleaning-validating-transforming.html#create-new-variables"><i class="fa fa-check"></i><b>2.3</b> Create New Variables</a></li>
<li class="chapter" data-level="2.4" data-path="extracting-cleaning-validating-transforming.html"><a href="extracting-cleaning-validating-transforming.html#validating-count-handedness-game-year"><i class="fa fa-check"></i><b>2.4</b> Validating Count, Handedness, Game Year</a></li>
<li class="chapter" data-level="2.5" data-path="extracting-cleaning-validating-transforming.html"><a href="extracting-cleaning-validating-transforming.html#remove-and-transform-event-values"><i class="fa fa-check"></i><b>2.5</b> Remove and Transform Event Values</a></li>
<li class="chapter" data-level="2.6" data-path="extracting-cleaning-validating-transforming.html"><a href="extracting-cleaning-validating-transforming.html#event-outcome-frequency-by-count"><i class="fa fa-check"></i><b>2.6</b> Event Outcome Frequency by Count</a></li>
<li class="chapter" data-level="2.7" data-path="extracting-cleaning-validating-transforming.html"><a href="extracting-cleaning-validating-transforming.html#average-delta-run-expectancy"><i class="fa fa-check"></i><b>2.7</b> Average Delta Run Expectancy</a></li>
<li class="chapter" data-level="2.8" data-path="extracting-cleaning-validating-transforming.html"><a href="extracting-cleaning-validating-transforming.html#join-lookup-table-to-data-set"><i class="fa fa-check"></i><b>2.8</b> Join Lookup Table to Data Set</a></li>
<li class="chapter" data-level="2.9" data-path="extracting-cleaning-validating-transforming.html"><a href="extracting-cleaning-validating-transforming.html#addressing-pitch-types"><i class="fa fa-check"></i><b>2.9</b> Addressing Pitch Types</a></li>
<li class="chapter" data-level="2.10" data-path="extracting-cleaning-validating-transforming.html"><a href="extracting-cleaning-validating-transforming.html#cleaning-pitch-locations"><i class="fa fa-check"></i><b>2.10</b> Cleaning Pitch Locations</a></li>
<li class="chapter" data-level="2.11" data-path="extracting-cleaning-validating-transforming.html"><a href="extracting-cleaning-validating-transforming.html#count-of-all-observations"><i class="fa fa-check"></i><b>2.11</b> Count of All Observations</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="example-model.html"><a href="example-model.html"><i class="fa fa-check"></i><b>3</b> Example Model</a>
<ul>
<li class="chapter" data-level="3.1" data-path="example-model.html"><a href="example-model.html#scatterplot-of-example-data"><i class="fa fa-check"></i><b>3.1</b> Scatterplot of Example Data</a></li>
<li class="chapter" data-level="3.2" data-path="example-model.html"><a href="example-model.html#scatterplot-of-example-data-filtered"><i class="fa fa-check"></i><b>3.2</b> Scatterplot of Example Data Filtered</a></li>
<li class="chapter" data-level="3.3" data-path="example-model.html"><a href="example-model.html#create-grid"><i class="fa fa-check"></i><b>3.3</b> Create Grid</a></li>
<li class="chapter" data-level="3.4" data-path="example-model.html"><a href="example-model.html#apply-game-results-to-grid"><i class="fa fa-check"></i><b>3.4</b> Apply Game Results to Grid</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>4</b> Functions</a>
<ul>
<li class="chapter" data-level="4.1" data-path="functions.html"><a href="functions.html#function-1"><i class="fa fa-check"></i><b>4.1</b> Function 1</a></li>
<li class="chapter" data-level="4.2" data-path="functions.html"><a href="functions.html#function-2"><i class="fa fa-check"></i><b>4.2</b> Function 2</a></li>
<li class="chapter" data-level="4.3" data-path="functions.html"><a href="functions.html#function-3"><i class="fa fa-check"></i><b>4.3</b> Function 3</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="applying-functions.html"><a href="applying-functions.html"><i class="fa fa-check"></i><b>5</b> Applying Functions</a>
<ul>
<li class="chapter" data-level="5.1" data-path="applying-functions.html"><a href="applying-functions.html#create-data-frames"><i class="fa fa-check"></i><b>5.1</b> Create Data Frames</a></li>
<li class="chapter" data-level="5.2" data-path="applying-functions.html"><a href="applying-functions.html#create-plots"><i class="fa fa-check"></i><b>5.2</b> Create Plots</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="visualizing-resulting-plots.html"><a href="visualizing-resulting-plots.html"><i class="fa fa-check"></i><b>6</b> Visualizing Resulting Plots</a>
<ul>
<li class="chapter" data-level="6.1" data-path="visualizing-resulting-plots.html"><a href="visualizing-resulting-plots.html#plot-outputs"><i class="fa fa-check"></i><b>6.1</b> Plot Outputs</a></li>
<li class="chapter" data-level="6.2" data-path="visualizing-resulting-plots.html"><a href="visualizing-resulting-plots.html#compile-results-into-1-lookup-table"><i class="fa fa-check"></i><b>6.2</b> Compile Results into 1 Lookup Table</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="applying-results-to-2023-season.html"><a href="applying-results-to-2023-season.html"><i class="fa fa-check"></i><b>7</b> Applying Results to 2023 Season</a>
<ul>
<li class="chapter" data-level="7.1" data-path="applying-results-to-2023-season.html"><a href="applying-results-to-2023-season.html#cleaning-2023-dataset"><i class="fa fa-check"></i><b>7.1</b> Cleaning 2023 Dataset</a></li>
<li class="chapter" data-level="7.2" data-path="applying-results-to-2023-season.html"><a href="applying-results-to-2023-season.html#location-quality-by-pitch-type"><i class="fa fa-check"></i><b>7.2</b> Location Quality by Pitch Type</a></li>
<li class="chapter" data-level="7.3" data-path="applying-results-to-2023-season.html"><a href="applying-results-to-2023-season.html#location-quality-by-count"><i class="fa fa-check"></i><b>7.3</b> Location Quality by Count</a></li>
<li class="chapter" data-level="7.4" data-path="applying-results-to-2023-season.html"><a href="applying-results-to-2023-season.html#final-cleaning"><i class="fa fa-check"></i><b>7.4</b> Final Cleaning</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="shiny-dashbaord.html"><a href="shiny-dashbaord.html"><i class="fa fa-check"></i><b>8</b> Shiny Dashbaord</a></li>
<li class="chapter" data-level="9" data-path="project-takeaways-and-limitations.html"><a href="project-takeaways-and-limitations.html"><i class="fa fa-check"></i><b>9</b> Project Takeaways and Limitations</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Quality of Location - developing a new pitch metric</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functions" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Functions<a href="functions.html#functions" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>These functions essentially replicate the previous steps demonstrated in the example model. However, they enable us to iteratively perform the process for all combinations of handedness, pitch type, and count. By inputting specific parameters into these functions, we can generate a resulting data frame and plot for each unique combination of handedness, count, and pitch type. This systematic approach allows for a comprehensive examination of pitch location effectiveness across a wide range of scenarios in the dataset.</p>
<div id="function-1" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Function 1<a href="functions.html#function-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="functions.html#cb51-1" tabindex="-1"></a>function_p_type_hand_ptiles <span class="ot">&lt;-</span> <span class="cf">function</span>(df, hand, pitch_type) {</span>
<span id="cb51-2"><a href="functions.html#cb51-2" tabindex="-1"></a>  hand <span class="ot">=</span> <span class="fu">enquo</span>(hand)</span>
<span id="cb51-3"><a href="functions.html#cb51-3" tabindex="-1"></a>  pitch_type <span class="ot">=</span> <span class="fu">enquo</span>(pitch_type)</span>
<span id="cb51-4"><a href="functions.html#cb51-4" tabindex="-1"></a>  hand_pitch_df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">UQ</span>(hand) <span class="sc">==</span> hand, <span class="fu">UQ</span>(pitch_type) <span class="sc">==</span> pitch_type)</span>
<span id="cb51-5"><a href="functions.html#cb51-5" tabindex="-1"></a></span>
<span id="cb51-6"><a href="functions.html#cb51-6" tabindex="-1"></a>  gf <span class="ot">&lt;-</span> <span class="fu">gam</span>(re <span class="sc">~</span> <span class="fu">s</span>(x, y), <span class="at">data =</span> hand_pitch_df)</span>
<span id="cb51-7"><a href="functions.html#cb51-7" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="function-2" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Function 2<a href="functions.html#function-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="functions.html#cb52-1" tabindex="-1"></a>location_quality <span class="ot">&lt;-</span> <span class="cf">function</span>(df, hand, pitch_type, count, gf) {</span>
<span id="cb52-2"><a href="functions.html#cb52-2" tabindex="-1"></a>  </span>
<span id="cb52-3"><a href="functions.html#cb52-3" tabindex="-1"></a>  hand <span class="ot">=</span> <span class="fu">enquo</span>(hand)</span>
<span id="cb52-4"><a href="functions.html#cb52-4" tabindex="-1"></a>  pitch_type <span class="ot">=</span> <span class="fu">enquo</span>(pitch_type)</span>
<span id="cb52-5"><a href="functions.html#cb52-5" tabindex="-1"></a>  count <span class="ot">=</span> <span class="fu">enquo</span>(count)</span>
<span id="cb52-6"><a href="functions.html#cb52-6" tabindex="-1"></a>  count_df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">UQ</span>(count) <span class="sc">==</span> count)</span>
<span id="cb52-7"><a href="functions.html#cb52-7" tabindex="-1"></a>  hand_pitch_df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">UQ</span>(hand) <span class="sc">==</span> hand, <span class="fu">UQ</span>(pitch_type) <span class="sc">==</span> pitch_type)</span>
<span id="cb52-8"><a href="functions.html#cb52-8" tabindex="-1"></a>  hand_pitch_count_df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">UQ</span>(hand) <span class="sc">==</span> hand, <span class="fu">UQ</span>(pitch_type) <span class="sc">==</span> pitch_type, <span class="fu">UQ</span>(count) <span class="sc">==</span> count)</span>
<span id="cb52-9"><a href="functions.html#cb52-9" tabindex="-1"></a>  hand_count_df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">UQ</span>(hand) <span class="sc">==</span> hand, <span class="fu">UQ</span>(count) <span class="sc">==</span> count)</span>
<span id="cb52-10"><a href="functions.html#cb52-10" tabindex="-1"></a>  </span>
<span id="cb52-11"><a href="functions.html#cb52-11" tabindex="-1"></a>  n <span class="ot">&lt;-</span> hand_pitch_count_df <span class="sc">%&gt;%</span> <span class="fu">count</span>() <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb52-12"><a href="functions.html#cb52-12" tabindex="-1"></a>  </span>
<span id="cb52-13"><a href="functions.html#cb52-13" tabindex="-1"></a>  <span class="cf">if</span> (n <span class="sc">&gt;</span> <span class="dv">10000</span>) {</span>
<span id="cb52-14"><a href="functions.html#cb52-14" tabindex="-1"></a>    hand_pitch_count_df <span class="ot">&lt;-</span> hand_pitch_count_df <span class="sc">%&gt;%</span> <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">10000</span>)</span>
<span id="cb52-15"><a href="functions.html#cb52-15" tabindex="-1"></a>  }</span>
<span id="cb52-16"><a href="functions.html#cb52-16" tabindex="-1"></a>  </span>
<span id="cb52-17"><a href="functions.html#cb52-17" tabindex="-1"></a>  </span>
<span id="cb52-18"><a href="functions.html#cb52-18" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="fl">0.01</span>), <span class="at">y =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">6</span>, <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb52-19"><a href="functions.html#cb52-19" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x=</span><span class="fu">round</span>(x,<span class="dv">2</span>), <span class="at">y=</span><span class="fu">round</span>(y,<span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb52-20"><a href="functions.html#cb52-20" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb52-21"><a href="functions.html#cb52-21" tabindex="-1"></a>  </span>
<span id="cb52-22"><a href="functions.html#cb52-22" tabindex="-1"></a><span class="co">#gf &lt;- gam(re ~ s(x, y), data = hand_pitch_df)</span></span>
<span id="cb52-23"><a href="functions.html#cb52-23" tabindex="-1"></a>  </span>
<span id="cb52-24"><a href="functions.html#cb52-24" tabindex="-1"></a>gfa <span class="ot">&lt;-</span> gf <span class="sc">%&gt;%</span> <span class="fu">augment</span>()</span>
<span id="cb52-25"><a href="functions.html#cb52-25" tabindex="-1"></a>  </span>
<span id="cb52-26"><a href="functions.html#cb52-26" tabindex="-1"></a>gfa99 <span class="ot">&lt;-</span> gfa <span class="sc">%&gt;%</span> </span>
<span id="cb52-27"><a href="functions.html#cb52-27" tabindex="-1"></a>  <span class="fu">filter</span>(.hat <span class="sc">&lt;=</span> <span class="fu">quantile</span>(gfa<span class="sc">$</span>.hat, <span class="fl">0.99</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb52-28"><a href="functions.html#cb52-28" tabindex="-1"></a>  <span class="fu">select</span>(x, y)</span>
<span id="cb52-29"><a href="functions.html#cb52-29" tabindex="-1"></a></span>
<span id="cb52-30"><a href="functions.html#cb52-30" tabindex="-1"></a>aa <span class="ot">&lt;-</span> gfa99 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(x) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">ymin=</span><span class="fu">min</span>(y), <span class="at">ymax=</span><span class="fu">max</span>(y))</span>
<span id="cb52-31"><a href="functions.html#cb52-31" tabindex="-1"></a></span>
<span id="cb52-32"><a href="functions.html#cb52-32" tabindex="-1"></a>bb <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(g,aa, <span class="fu">join_by</span>(x<span class="sc">==</span>x, y<span class="sc">&gt;=</span>ymin, y<span class="sc">&lt;=</span>ymax)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>y) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb52-33"><a href="functions.html#cb52-33" tabindex="-1"></a></span>
<span id="cb52-34"><a href="functions.html#cb52-34" tabindex="-1"></a>cc <span class="ot">&lt;-</span> g <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(bb, <span class="fu">join_by</span>(x<span class="sc">==</span>x, y<span class="sc">&gt;=</span>ymin, y<span class="sc">&lt;=</span>ymax)) <span class="sc">%&gt;%</span> </span>
<span id="cb52-35"><a href="functions.html#cb52-35" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(ymin), <span class="sc">!</span><span class="fu">is.na</span>(ymax)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(x,y)</span>
<span id="cb52-36"><a href="functions.html#cb52-36" tabindex="-1"></a></span>
<span id="cb52-37"><a href="functions.html#cb52-37" tabindex="-1"></a>dd <span class="ot">&lt;-</span> cc <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(y) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">xmin=</span><span class="fu">min</span>(x), <span class="at">xmax=</span><span class="fu">max</span>(x))</span>
<span id="cb52-38"><a href="functions.html#cb52-38" tabindex="-1"></a></span>
<span id="cb52-39"><a href="functions.html#cb52-39" tabindex="-1"></a>ee <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(g,dd, <span class="fu">join_by</span>(y<span class="sc">==</span>y, x<span class="sc">&gt;=</span>xmin, x<span class="sc">&lt;=</span>xmax)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>x) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb52-40"><a href="functions.html#cb52-40" tabindex="-1"></a></span>
<span id="cb52-41"><a href="functions.html#cb52-41" tabindex="-1"></a>ff <span class="ot">&lt;-</span> g <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(ee, <span class="fu">join_by</span>(y<span class="sc">==</span>y, x<span class="sc">&gt;=</span>xmin, x<span class="sc">&lt;=</span>xmax)) <span class="sc">%&gt;%</span> </span>
<span id="cb52-42"><a href="functions.html#cb52-42" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(xmin), <span class="sc">!</span><span class="fu">is.na</span>(xmax)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(x,y)</span>
<span id="cb52-43"><a href="functions.html#cb52-43" tabindex="-1"></a></span>
<span id="cb52-44"><a href="functions.html#cb52-44" tabindex="-1"></a>gg <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(cc,ff) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb52-45"><a href="functions.html#cb52-45" tabindex="-1"></a></span>
<span id="cb52-46"><a href="functions.html#cb52-46" tabindex="-1"></a>aa <span class="ot">&lt;-</span> gg <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(x) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">ymin=</span><span class="fu">min</span>(y), <span class="at">ymax=</span><span class="fu">max</span>(y))</span>
<span id="cb52-47"><a href="functions.html#cb52-47" tabindex="-1"></a></span>
<span id="cb52-48"><a href="functions.html#cb52-48" tabindex="-1"></a>bb <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(g,aa, <span class="fu">join_by</span>(x<span class="sc">==</span>x, y<span class="sc">&gt;=</span>ymin, y<span class="sc">&lt;=</span>ymax)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>y) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb52-49"><a href="functions.html#cb52-49" tabindex="-1"></a></span>
<span id="cb52-50"><a href="functions.html#cb52-50" tabindex="-1"></a>cc <span class="ot">&lt;-</span> g <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(bb, <span class="fu">join_by</span>(x<span class="sc">==</span>x, y<span class="sc">&gt;=</span>ymin, y<span class="sc">&lt;=</span>ymax)) <span class="sc">%&gt;%</span> </span>
<span id="cb52-51"><a href="functions.html#cb52-51" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(ymin), <span class="sc">!</span><span class="fu">is.na</span>(ymax)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(x,y)</span>
<span id="cb52-52"><a href="functions.html#cb52-52" tabindex="-1"></a></span>
<span id="cb52-53"><a href="functions.html#cb52-53" tabindex="-1"></a>dd <span class="ot">&lt;-</span> cc <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(y) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">xmin=</span><span class="fu">min</span>(x), <span class="at">xmax=</span><span class="fu">max</span>(x))</span>
<span id="cb52-54"><a href="functions.html#cb52-54" tabindex="-1"></a></span>
<span id="cb52-55"><a href="functions.html#cb52-55" tabindex="-1"></a>ee <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(g,dd, <span class="fu">join_by</span>(y<span class="sc">==</span>y, x<span class="sc">&gt;=</span>xmin, x<span class="sc">&lt;=</span>xmax)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>x) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb52-56"><a href="functions.html#cb52-56" tabindex="-1"></a></span>
<span id="cb52-57"><a href="functions.html#cb52-57" tabindex="-1"></a>ff <span class="ot">&lt;-</span> g <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(ee, <span class="fu">join_by</span>(y<span class="sc">==</span>y, x<span class="sc">&gt;=</span>xmin, x<span class="sc">&lt;=</span>xmax)) <span class="sc">%&gt;%</span> </span>
<span id="cb52-58"><a href="functions.html#cb52-58" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(xmin), <span class="sc">!</span><span class="fu">is.na</span>(xmax)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(x,y)</span>
<span id="cb52-59"><a href="functions.html#cb52-59" tabindex="-1"></a></span>
<span id="cb52-60"><a href="functions.html#cb52-60" tabindex="-1"></a>gg <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(cc,ff) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb52-61"><a href="functions.html#cb52-61" tabindex="-1"></a></span>
<span id="cb52-62"><a href="functions.html#cb52-62" tabindex="-1"></a>gf1 <span class="ot">&lt;-</span> <span class="fu">gam</span>(re <span class="sc">~</span> <span class="fu">s</span>(x, y), <span class="at">data =</span> hand_pitch_count_df, <span class="at">method =</span> <span class="st">&quot;REML&quot;</span>)</span>
<span id="cb52-63"><a href="functions.html#cb52-63" tabindex="-1"></a>  </span>
<span id="cb52-64"><a href="functions.html#cb52-64" tabindex="-1"></a>gg<span class="sc">$</span>lp <span class="ot">&lt;-</span> <span class="fu">predict</span>(gf1, gg, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb52-65"><a href="functions.html#cb52-65" tabindex="-1"></a></span>
<span id="cb52-66"><a href="functions.html#cb52-66" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">%&gt;%</span></span>
<span id="cb52-67"><a href="functions.html#cb52-67" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hand =</span> <span class="fu">unique</span>(hand_pitch_count_df<span class="sc">$</span>hand),</span>
<span id="cb52-68"><a href="functions.html#cb52-68" tabindex="-1"></a>         <span class="at">pitch_type =</span> <span class="fu">unique</span>(hand_pitch_count_df<span class="sc">$</span>pitch_type),</span>
<span id="cb52-69"><a href="functions.html#cb52-69" tabindex="-1"></a>         <span class="at">count =</span> <span class="fu">unique</span>(hand_pitch_count_df<span class="sc">$</span>count)) <span class="sc">%&gt;%</span></span>
<span id="cb52-70"><a href="functions.html#cb52-70" tabindex="-1"></a>  <span class="fu">select</span>(hand, pitch_type, count, x, y, lp)</span>
<span id="cb52-71"><a href="functions.html#cb52-71" tabindex="-1"></a></span>
<span id="cb52-72"><a href="functions.html#cb52-72" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">pq =</span> (lp <span class="sc">-</span> <span class="fu">min</span>(lp)) <span class="sc">/</span> (<span class="fu">max</span>(lp) <span class="sc">-</span> <span class="fu">min</span>(lp))) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>lp) <span class="sc">%&gt;%</span></span>
<span id="cb52-73"><a href="functions.html#cb52-73" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pq =</span> <span class="dv">1</span><span class="sc">-</span>pq)</span>
<span id="cb52-74"><a href="functions.html#cb52-74" tabindex="-1"></a></span>
<span id="cb52-75"><a href="functions.html#cb52-75" tabindex="-1"></a><span class="fu">return</span>(gg)</span>
<span id="cb52-76"><a href="functions.html#cb52-76" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="function-3" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Function 3<a href="functions.html#function-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="functions.html#cb53-1" tabindex="-1"></a>location_quality_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb53-2"><a href="functions.html#cb53-2" tabindex="-1"></a>  </span>
<span id="cb53-3"><a href="functions.html#cb53-3" tabindex="-1"></a>    hand <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">hand_id =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), <span class="at">hand =</span> <span class="fu">c</span>(<span class="st">&quot;RvR&quot;</span>,<span class="st">&quot;RvL&quot;</span>,<span class="st">&quot;LvL&quot;</span>,<span class="st">&quot;LvR&quot;</span>))</span>
<span id="cb53-4"><a href="functions.html#cb53-4" tabindex="-1"></a>    pitch_type <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">pitch_type_id =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>), </span>
<span id="cb53-5"><a href="functions.html#cb53-5" tabindex="-1"></a>                         <span class="at">pitch_type =</span> <span class="fu">c</span>(<span class="st">&quot;FF&quot;</span>,<span class="st">&quot;SI&quot;</span>,<span class="st">&quot;FC&quot;</span>,<span class="st">&quot;CH&quot;</span>,<span class="st">&quot;CU&quot;</span>,<span class="st">&quot;SL&quot;</span>))</span>
<span id="cb53-6"><a href="functions.html#cb53-6" tabindex="-1"></a>    count <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">count_id =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>), </span>
<span id="cb53-7"><a href="functions.html#cb53-7" tabindex="-1"></a>                    <span class="at">count =</span> <span class="fu">c</span>(<span class="st">&quot;0-0&quot;</span>,<span class="st">&quot;0-1&quot;</span>,<span class="st">&quot;0-2&quot;</span>,<span class="st">&quot;1-0&quot;</span>,<span class="st">&quot;1-1&quot;</span>,<span class="st">&quot;1-2&quot;</span>,<span class="st">&quot;2-0&quot;</span>,<span class="st">&quot;2-1&quot;</span>,<span class="st">&quot;2-2&quot;</span>,<span class="st">&quot;3-0&quot;</span>,<span class="st">&quot;3-1&quot;</span>,<span class="st">&quot;3-2&quot;</span>))</span>
<span id="cb53-8"><a href="functions.html#cb53-8" tabindex="-1"></a></span>
<span id="cb53-9"><a href="functions.html#cb53-9" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb53-10"><a href="functions.html#cb53-10" tabindex="-1"></a>    <span class="fu">inner_join</span>(hand, <span class="fu">join_by</span>(hand<span class="sc">==</span>hand_id)) <span class="sc">%&gt;%</span></span>
<span id="cb53-11"><a href="functions.html#cb53-11" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>hand) <span class="sc">%&gt;%</span></span>
<span id="cb53-12"><a href="functions.html#cb53-12" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">hand=</span>hand.y) <span class="sc">%&gt;%</span></span>
<span id="cb53-13"><a href="functions.html#cb53-13" tabindex="-1"></a>    <span class="fu">inner_join</span>(pitch_type, <span class="fu">join_by</span>(pitch_type<span class="sc">==</span>pitch_type_id)) <span class="sc">%&gt;%</span></span>
<span id="cb53-14"><a href="functions.html#cb53-14" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>pitch_type) <span class="sc">%&gt;%</span></span>
<span id="cb53-15"><a href="functions.html#cb53-15" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">pitch_type=</span>pitch_type.y) <span class="sc">%&gt;%</span></span>
<span id="cb53-16"><a href="functions.html#cb53-16" tabindex="-1"></a>    <span class="fu">inner_join</span>(count, <span class="fu">join_by</span>(count<span class="sc">==</span>count_id)) <span class="sc">%&gt;%</span></span>
<span id="cb53-17"><a href="functions.html#cb53-17" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>count) <span class="sc">%&gt;%</span></span>
<span id="cb53-18"><a href="functions.html#cb53-18" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">count=</span>count.y)</span>
<span id="cb53-19"><a href="functions.html#cb53-19" tabindex="-1"></a>  </span>
<span id="cb53-20"><a href="functions.html#cb53-20" tabindex="-1"></a>  <span class="fu">rm</span>(hand, pitch_type, count)</span>
<span id="cb53-21"><a href="functions.html#cb53-21" tabindex="-1"></a>  </span>
<span id="cb53-22"><a href="functions.html#cb53-22" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">paste</span>(hand, pitch_type, count, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>))</span>
<span id="cb53-23"><a href="functions.html#cb53-23" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb53-24"><a href="functions.html#cb53-24" tabindex="-1"></a>      <span class="fu">geom_tile</span>(<span class="at">data=</span> df, <span class="fu">aes</span>(x,y, <span class="at">fill =</span> pq), <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb53-25"><a href="functions.html#cb53-25" tabindex="-1"></a>      <span class="fu">geom_rect</span>(<span class="fu">aes</span>(<span class="at">ymax =</span> <span class="fl">3.50</span>, <span class="at">ymin =</span> <span class="fl">1.5</span>, <span class="at">xmax =</span> <span class="fl">0.83</span>, <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">0.83</span>),</span>
<span id="cb53-26"><a href="functions.html#cb53-26" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">linewidth=</span><span class="fl">0.1</span>, <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-27"><a href="functions.html#cb53-27" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="fu">unique</span>(df<span class="sc">$</span>label)) <span class="sc">+</span></span>
<span id="cb53-28"><a href="functions.html#cb53-28" tabindex="-1"></a>      <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb53-29"><a href="functions.html#cb53-29" tabindex="-1"></a>      <span class="fu">scale_fill_viridis_c</span>(<span class="at">direction =</span> <span class="dv">1</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb53-30"><a href="functions.html#cb53-30" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb53-31"><a href="functions.html#cb53-31" tabindex="-1"></a>            <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb53-32"><a href="functions.html#cb53-32" tabindex="-1"></a>            <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb53-33"><a href="functions.html#cb53-33" tabindex="-1"></a>            <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb53-34"><a href="functions.html#cb53-34" tabindex="-1"></a>      <span class="fu">coord_fixed</span>()</span>
<span id="cb53-35"><a href="functions.html#cb53-35" tabindex="-1"></a>}</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="example-model.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="applying-functions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/drose1988/pitch_location_quality_project/edit/main/04-functions.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/drose1988/pitch_location_quality_project/blob/main/04-functions.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
